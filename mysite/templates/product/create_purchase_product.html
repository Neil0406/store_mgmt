{% extends 'base.html' %}

{% block title %}
<title>進貨</title>
{% endblock %}

{% block body %}
<div class="container">
    <h5>商品進貨</h5>
    <div class="row">
        <div class="card col-lg-12 col-md-12 col-12">
            <div class="card-body">
                <div class="row my-3">
                    {% csrf_token %}
                    <div class="col-lg-3 col-md-6 col-6">
                        <h6>廠商＊</h6>
                        <select class="form-control" id="company_id">
                            <option hidden select value="">廠商</option>
                            {% if company_list %}
                                {% for i in company_list %}
                                    <option value="{{i.id}}">{{i}}</option>
                                {% endfor %}
                            {% else %}
                                <option value="">沒有廠商</option>
                            {% endif %}
                        </select>
                    </div>        
                    <div class="col-lg-3 col-md-6 col-6" id="types_custom">
                        <h6>種類＊</h6>
                        <select class="form-control" id="types">
                            <option hidden select value="">種類</option>
                        </select>
                    </div>
                </div>

                <div class="row my-3">
                    <div class="col-lg-3 col-md-6 col-6" id="brand_custom">
                        <h6>品牌＊</h6>
                        <select class="form-control" id="brand">
                            <option hidden select value="">品牌</option>
                        </select>
                    </div>
                </div>
                
       
                <div class="row my-3">
                    <div class="col-lg-3 col-md-6 col-6" id="model_custom">
                        <h6>型號 / 編號＊</h6>
                        <select class="form-control" id="model">
                            <option hidden select value="">型號 / 編號</option>>
                        </select>
                    </div>
                    <div class="col-lg-3 col-md-6 col-6">
                        <h6>品名＊</h6>
                        <select class="form-control" id="name">
                            <option hidden select value="">品名</option>
                        </select>
                    </div>
                </div>

                <div class="row my-3">
                    <div class="col-lg-3 col-md-6 col-6">
                        <h6>進價(單價)＊</h6>
                        <input class="form-control" type="number" step=any id="purchase_price">
                    </div>
                    <div class="col-lg-3 col-md-6 col-6">
                        <h6>售價(單價)＊</h6>
                        <input class="form-control" type="number" step=any id="selling_price">
                    </div>
                </div>
                <div class="row my-3">
                    <div class="col-lg-3 col-md-6 col-6">
                        <h6>進貨數量＊</h6>
                        <input class="form-control" type="number" step=any id="amount">
                    </div>
                </div>

                <div class="row my-3">
                    <div class="col-lg-3 col-md-6 col-6">
                        <h6>進貨日期</h6>
                        <input class="form-control" type="date" id="purchase_date">
                    </div>
                </div>

                <div class="row my-3">
                    <div class="col-lg-2 col-md-6 col-6">
                        <h6>圖片1</h6>
                        <input class="" type="file" id="image" accept="image/*" multiple="multiple">
                    </div>
                    <div class="col-lg-2 col-md-6 col-6">
                        <h6>圖片2</h6>
                        <input class="" type="file" id="image2" accept="image/*" multiple="multiple">
                    </div>
                    <div class="col-lg-2 col-md-6 col-6">
                        <h6>圖片3</h6>
                        <input class="" type="file" id="image3" accept="image/*" multiple="multiple">
                    </div>
                </div>

                <div class="row my-3">
                    <div class="col-lg-6 col-md-12 col-12">
                        <h6>其他資訊</h6>
                        <textarea style="width:100%;height:100px;" id="info"></textarea>
                    </div>
                </div>

                <div class="row my-3">
                    <div class="col-lg-12 col-md-12 col-12">
                        <button class="btn btn-primary" id="sub">送出</button>
                        <button class="btn btn-danger" id="reset">清除</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<br>
{% endblock %}


{% block js%}
<script>
    window.onload=today;
    function today() {
        var NowDate = new Date();
        var y = NowDate.getFullYear();
        var m = NowDate.getMonth() + 1;
        var d = NowDate.getDate();
        m = ("0" + m).slice(-2);
        d = ("0" + d).slice(-2);
        document.getElementById('purchase_date').value = y + '-'+ m + '-' + d;
    };

    $('#company_id').change(function(){
        var id_ = $('#company_id').val();
        document.getElementById('types').innerHTML = '<option hidden select value="">種類</option>'
        document.getElementById('brand').innerHTML = '<option hidden select value="">品牌</option>'
        document.getElementById('model').innerHTML = '<option hidden select value="">型號 / 編號</option>'
        document.getElementById('name').innerHTML = '<option hidden select value="">品名</option>'
        $.ajax({
            url: '/company/get_company_product_types/', 
            type: 'POST',  
            headers: {'X-CSRFToken': $('[name="csrfmiddlewaretoken"]').val()},
            data: {
                company_id: id_
            },
            success: function (data) {
                var data = JSON.parse(data);
                if(data.data.length != 0 && data.data != 'error'){
                    var show_types = '<option hidden select value="">種類</option>'
                    for(i=0; i<data.data.length; i++){
                        show_types += '<option value="'+data.data[i]+'">'+data.data[i]+'</option>'
                    }
                    document.getElementById('types').innerHTML = show_types
                }else{
                    document.getElementById('types').innerHTML ='<option hidden select value="">沒有商品</option>'
                }
            }
        });
    });

    $('#types').change(function(){
        document.getElementById('brand').innerHTML = '<option hidden select value="">品牌</option>'
        document.getElementById('model').innerHTML = '<option hidden select value="">型號 / 編號</option>'
        document.getElementById('name').innerHTML = '<option hidden select value="">品名</option>'
        var id_ = $('#company_id').val();
        var types = $('#types').val();
        $.ajax({
            url: '/company/get_company_product_brand/', 
            type: 'POST',  
            headers: {'X-CSRFToken': $('[name="csrfmiddlewaretoken"]').val()},
            data: {
                company_id: id_,
                types: types
            },
            success: function (data) {
                var data = JSON.parse(data);
                if(data.data.length != 0 && data.data != 'error'){
                    var show_types = '<option hidden select value="">品牌</option>'
                    for(i=0; i<data.data.length; i++){
                        show_types += '<option value="'+data.data[i]+'">'+data.data[i]+'</option>'
                    }
                    document.getElementById('brand').innerHTML = show_types
                }
            }
        });
    });


    $('#brand').change(function(){
        document.getElementById('model').innerHTML = '<option hidden select value="">型號 / 編號</option>'
        document.getElementById('name').innerHTML = '<option hidden select value="">品名</option>'
        var id_ = $('#company_id').val();
        var types = $('#types').val();
        var brand = $('#brand').val();
        $.ajax({
            url: '/company/get_company_product_model/', 
            type: 'POST',  
            headers: {'X-CSRFToken': $('[name="csrfmiddlewaretoken"]').val()},
            data: {
                company_id: id_,
                types: types,
                brand: brand
            },
            success: function (data) {
                var data = JSON.parse(data);
                if(data.data.length != 0 && data.data != 'error'){
                    var show_types = '<option hidden select value="">型號 / 編號</option>'
                    for(i=0; i<data.data.length; i++){
                        show_types += '<option value="'+data.data[i]+'">'+data.data[i]+'</option>'
                    }
                    document.getElementById('model').innerHTML = show_types
                }
            }
        });
    });


    $('#model').change(function(){
        document.getElementById('name').innerHTML = '<option hidden select value="">品名</option>'
        var id_ = $('#company_id').val();
        var types = $('#types').val();
        var brand = $('#brand').val();
        var model = $('#model').val();
        $.ajax({
            url: '/company/get_company_product_name/', 
            type: 'POST',  
            headers: {'X-CSRFToken': $('[name="csrfmiddlewaretoken"]').val()},
            data: {
                company_id: id_,
                types: types,
                brand: brand,
                model:model
            },
            success: function (data) {
                var data = JSON.parse(data);
                if(data.data.length != 0){
                    var show_types = '<option hidden select value="">品名</option>'
                    for(i=0; i<data.data.length; i++){
                        show_types += '<option value="'+data.data[i]+'">'+data.data[i]+'</option>'
                    }
                    document.getElementById('name').innerHTML = show_types
                }
            }
        });
    });


</script>

{% endblock %}