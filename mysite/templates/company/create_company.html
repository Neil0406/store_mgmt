{% extends  'base.html' %}

{% block title%}
<title>新增廠商</title>  
{% endblock %}


{% block body %}
<div class="container">
    <h5>新增廠商</h5>
    <div class="row">
        <div class="card col-12">
            <div class="card-body">
                {% csrf_token %}
                <div class="row my-3">
                    <div class="col-lg-3 col-md-12 col-12">
                        <h6>廠商＊</h6>
                        <input class="form-control g" type="text" id="company_name">
                    </div>
                </div>

                <div class="row my-3">
                    <div class="col-lg-2 col-md-6 col-6">
                        <h6>縣 / 市</h6>
                        <input class="form-control g" type="text" id="company_region" placeholder='臺北市'>
                    </div>
                    <div class="col-lg-2 col-md-6 col-6">
                        <h6>鄉 / 鎮 / 區</h6>
                        <input class="form-control g" type="text" id="company_town" placeholder='大安區'>
                    </div>
                </div>

                <div class="row my-3">
                    <div class="col-lg-6 col-md-12 col-sm-12">
                        <h6>地址</h6>
                        <input class="form-control g" type="text" id="company_address" placeholder='大安路一段10號'>
                    </div>
                </div>

                <div class="row my-3">
                    <div class="col-lg-3 col-md-8 col-8">
                        <h6>公司電話</h6>
                        <input class="form-control g" type="text" id="company_phone" placeholder='02-12345-678'>
                    </div>
                    <div class="col-lg-1 col-md-4 col-4">
                        <h6>分機</h6>
                        <input class="form-control g" type="text" id="company_ext" placeholder='123'>
                    </div>
                    <div class="col-lg-2 col-md-12 col-12">
                        <h6>公司聯絡人</h6>
                        <input class="form-control g" type="text" id="company_contact_person">
                    </div>
                    <div class="col-lg-4 col-md-12 col-12">
                        <h6>Email</h6>
                        <input class="form-control g" type="email" id="company_email" placeholder="Email@example.com">
                    </div>
                </div>

                <div class="row my-3">
                    <div class="col-lg-3 col-md-8 col-8">
                        <h6>手機</h6>
                        <input class="form-control g" type="text" id="mobile_phone" placeholder='0912-345-678'>
                    </div>
                    <div class="col-lg-2 col-md-4 col-4">
                        <h6>聯絡人</h6>
                        <input class="form-control g" type="text" id="mobile_contact_person">
                    </div>
                    <div class="col-lg-4 col-md-12 col-12">
                        <h6>Email</h6>
                        <input class="form-control g" type="email" id="mobile_email" placeholder="Email@example.com">
                    </div>
                </div>

                <div class="row my-3">
                    <div class="col-lg-6 col-md-12 col-12">
                        <h6>公司網址</h6>
                        <input class="form-control g" type="text" id="company_url" >
                    </div>
                </div>

                <div class="row my-3">
                    <div class="col-lg-6 col-md-12 col-12">
                        <h6>統一編號</h6>
                        <input class="form-control g" type="text" id="uniform_numbers">
                    </div>
                </div>

                <div class="row my-3">
                    <div class="col-lg-6 col-md-12 col-12">
                        <h6>其他資訊</h6>
                        <textarea style="width:100%;height:100px;" id='company_info'></textarea>
                    </div>
                </div>

                <div class="row my-3">
                    <div class="col-lg-12 col-md-12 col-12">
                        <button class="btn btn-success" id="sub">送出</button>
                        <button class="btn btn-danger" id="reset">清除</button>
                    </div>
                </div>

            </div>    
        </div>
    </div>
</div>
<br>
{% endblock %}

{% block js %}
<script>
    $(document).ready(function(){
        $("body").on("change", "#company_email", function (){
            $Emailchecking=IsEmail($("#company_email").val());
            if($Emailchecking==false){
                alert("請填寫正確的E-MAIL格式");
                $("#company_email").blur(); //離開焦點
            }          
        })
        function IsEmail(email) { 
            var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
                if(!regex.test(email)) { 
                    return false;
                }else{
            return true;
            } 
        }              
    });

    $(document).ready(function(){
        $("body").on("change", "#mobile_email", function (){
            $Emailchecking=IsEmail($("#mobile_email").val());
            if($Emailchecking==false){
                alert("請填寫正確的E-MAIL格式");
                $("#mobile_email").blur(); //離開焦點
            }          
        })
        function IsEmail(email) { 
            var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
                if(!regex.test(email)) { 
                    return false;
                }else{
            return true;
            } 
        }              
    });

    $('#reset').click(function(){
        var in_ = $('input.form-control.g')
        for(i=0; i<in_.length; i++){
            $('#' + in_[i].id).val('');
        }
        $('#company_info').val('');
    });

    function get_data(){
        var company_name = $('#company_name').val();
        var company_region = $('#company_region').val();
        var company_town = $('#company_town').val();
        var company_address = $('#company_address').val();
        var company_phone = $('#company_phone').val();
        var company_ext = $('#company_ext').val();
        var company_contact_person = $('#company_contact_person').val();
        var company_email = $('#company_email').val();
        var mobile_phone = $('#mobile_phone').val();
        var mobile_contact_person = $('#mobile_contact_person').val();
        var mobile_email = $('#mobile_email').val();
        var uniform_numbers = $('#uniform_numbers').val();
        var company_url = $('#company_url').val();
        var company_info = $('#company_info').val();
        return {'company_name':company_name,'company_region':company_region, 'company_town': company_town, 
        'company_address':company_address,'company_phone':company_phone, 'company_ext': company_ext,
        'company_contact_person':company_contact_person,'company_email':company_email, 'mobile_phone': mobile_phone,
        'mobile_contact_person':mobile_contact_person,'mobile_email':mobile_email, 'uniform_numbers': uniform_numbers,
        'company_url':company_url,'company_info':company_info}
    }

    $('#sub').click(function(){
        var data = get_data();
        if(!data['company_name'] || data['company_name'].trim().length === 0){
            alert ('請輸入廠商名')
        }
        else{
            $.ajax({
                url: '/create_company/', 
                type: 'POST',  
                headers: {'X-CSRFToken': $('[name="csrfmiddlewaretoken"]').val()},
                data: {
                    data: JSON.stringify(data),
                },  
                success: function (data) {
                    var data = JSON.parse(data);
                    if(data.data == 'success'){
                        alert ('新增成功')
                        window.location.reload();
                    }else if(data.data == 'exists'){
                        alert ('公司已存在')
                    }else if(data.data == 'restart'){
                        alert ('重新啟用公司')
                        window.location.reload();
                    }
                }
            });
        }
       
    });

</script>
{% endblock %}